# Node Utils (TypeScript é¡¹ç›®å·¥å…·åº“)

çŽ°ä»£åŒ–çš„ TypeScript å·¥å…·é›†åˆåº“ï¼Œæœ¬é¡¹ç›®æä¾›äº†ä¸€ç³»åˆ— Web3ã€æ•°æ®åº“ï¼ˆDatabase/Memory KVï¼‰ä»¥åŠ AI è°ƒç”¨å°è£…çš„å®žç”¨å·¥å…·åŒ…ï¼Œä½¿ç”¨ ESM æ¨¡å—ç³»ç»Ÿå¹¶ä»¥ Vitest ä½œä¸ºæµ‹è¯•æ¡†æž¶æ”¯æ’‘ã€‚

## ç®€ä»‹ (Project Description)

æœ¬é¡¹ç›®æ±‡èšäº†å¤šä¸ªå¸¸ç”¨é¢†åŸŸï¼ˆWeb3ã€DBã€AI ç­‰ï¼‰çš„è„šæœ¬åŠè¾…åŠ©ç±»ï¼Œæ—¨åœ¨æä¾›å¼€ç®±å³ç”¨ã€å®‰å…¨ç¨³å®šçš„ Node.js å·¥ç¨‹åŒ–ç»„ä»¶ï¼š
- **Web3 é›†æˆ**: åŒ…å«å®Œå–„çš„ `ethers.js` æ™ºèƒ½åˆçº¦çš„éƒ¨ç½²ã€è°ƒç”¨å·¥å…·ï¼ˆ`EthersTxHelper`ï¼‰ä»¥åŠ DeFi / Polymarket çš„ç›¸å…³å®¢æˆ·ç«¯é›†æˆä»£ç ã€‚
- **æ•°æ®åº“ç»„ä»¶**: æä¾› `KVSqlite` é”®å€¼æŒä¹…åŒ–æ–¹æ¡ˆä¸Ž `MemoryCache` å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚
- **AI åŠ©æ‰‹**: å«å¯¹ Gemini æ¨¡åž‹çš„ç®€æ˜“è°ƒç”¨ï¼ˆ`GeminiHelper`ï¼‰ã€‚

## ç‰¹æ€§ (Features)

- ðŸš€ **ES Modules** - ä½¿ç”¨åŽŸç”Ÿ ESM æ¨¡å—ç³»ç»Ÿ
- ðŸ“¦ **TypeScript** - æœ€æ–°ç‰ˆå¼ºç±»åž‹ç‰¹æ€§ä¸Žç¼–è¯‘ä½“éªŒ
- âš¡ **Vitest** - æžé€Ÿä¸”ç›´è§‚çš„å•å…ƒæµ‹è¯•
- ðŸ”¥ **tsx** - æ”¯æŒå¼€å‘çŽ¯å¢ƒä¸­ç›´æŽ¥è¿è¡Œ `.ts` è„šæœ¬
- ðŸŒ **Blockchain Ready** - é›†æˆäº†é’ˆå¯¹ `Ethers v6` ç­‰åŒºå—é“¾ç»„ä»¶è°ƒç”¨æœ€ä½³å®žè·µçš„ç±»å°è£…

## ðŸ¤– AI å˜åŠ¨è®°å½• (AI Update Log)

å½“ AI åŠ©æ‰‹è¿›è¡Œæ“ä½œã€æ–°å¢ž / åˆ å‡åŠŸèƒ½åŽï¼Œå°†ä¼šäºŽæ­¤å¤„æˆ– [ChangeLog.md](./ChangeLog.md) ä¸­æ›´æ–°æ‘˜è¦ã€‚

- **2026-02-25** (ç¬¬äºŒæ¬¡): S3 æ¨¡å—ç²¾ç®€ä¸Žä¸Šä¼  URL å¢žå¼º
  1. åˆ é™¤ `S3Sync`ï¼ˆæ–‡ä»¶å¤¹åŒæ­¥ï¼‰ä¸Ž `S3FolderUploader`ï¼ˆæ–‡ä»¶å¤¹æ‰¹é‡ä¸Šä¼ ï¼‰æ¨¡å—ï¼Œèšç„¦æ ¸å¿ƒèƒ½åŠ›ã€‚
  2. `S3Helper` ç§»é™¤å¤–éƒ¨ KV æ•°æ®åº“ä¾èµ–ï¼ˆ`IKVDatabase`ï¼‰ï¼Œé˜²é‡å¤ä¸Šä¼ æ”¹ç”¨å†…å­˜ `Map` å®žçŽ°ï¼Œé›¶é…ç½®å¼€ç®±å³ç”¨ã€‚
  3. `uploadFile` / `uploadBuffer` ç»Ÿä¸€è¿”å›ž `UploadResult`ï¼ˆå« `wasUploaded` æ ‡è®°ï¼‰ï¼Œé˜²é‡å¤é€»è¾‘å†…ç½®æ— éœ€å•ç‹¬è°ƒç”¨ `Advanced` ç‰ˆæœ¬ã€‚
  4. `S3UrlGenerator` æ–°å¢žä¸Šä¼  URL ç”Ÿæˆï¼š`generateOneTimeUploadUrl`ï¼ˆUUID å”¯ä¸€ keyï¼Œé˜²è¦†ç›–ï¼‰ã€`generateReusableUploadUrl`ï¼ˆå›ºå®š keyï¼Œæœ‰æ•ˆæœŸå†…å¯é‡å¤ä½¿ç”¨ï¼‰ã€`generateBatchOneTimeUploadUrls`ã€‚

- **2026-02-25** (ç¬¬ä¸€æ¬¡): 
  1. é‡æž„æ‹†åˆ†äº†åŽŸè¿‘ 3000 è¡Œçš„ `src/dbUtils/s3Helper.ts`ï¼ŒåŸºäºŽé¢†åŸŸåŠŸèƒ½è§£è€¦ä¸º `S3Helper`, `S3Sync`, `S3FolderUploader`, `S3UrlGenerator` åŠå¯¹åº”çš„ç±»åž‹ä¸­å¿ƒï¼Œå¹¶ç»Ÿä¸€è¿ç§»è‡³ `src/dbUtils/s3/`ï¼Œå®žçŽ°äº†æ¨¡å—é«˜å†…èšä½Žè€¦åˆã€‚
  2. ä¿®å¤äº† S3 `uploadFile/Buffer` ä¸­ MD5 é‡å¤è®¡ç®—é€ æˆçš„æ€§èƒ½æŸè€—æ¼æ´žï¼Œä»¥åŠ `DeleteObjects` æ‰¹é‡åˆ é™¤æŽ¥å£è¶…è¿‡ 1000 ä¸ªå¯¹è±¡å®¹é‡å¼•å‘å´©æºƒç­‰ P0 çº§ä¸¥é‡å¼‚å¸¸ã€‚
  3. é€šè¿‡åŽŸæ–‡ä»¶ç›´æŽ¥å…¨é‡åŒåå¯¼å‡ºæœºåˆ¶å®Œç¾Žä¿ç•™äº†å‘åŽå…¼å®¹æ€§ï¼ˆBackward Compatibilityï¼‰ã€‚

- **2026-02-24**: 
  1. ä¼˜åŒ– `src/web3/ethersTxHelper.ts` (åŽ»é™¤äº†å¯¼è‡´å‰ç«¯é˜»å¡žé•¿è¾¾æ•°åç§’çš„ `.wait()` å¼ºåˆ¶è°ƒç”¨ï¼Œå¢žè®¾å¯é€‰ `waitConfirm` å‚é‡)ã€‚
  2. ä¿®å¤äº†åŸºäºŽ `ethers.BrowserProvider` (å¦‚ MetaMask) å‘é€æˆ–éƒ¨ç½²åˆçº¦æ—¶å› ä¸ºç©ºç§é’¥å´©æºƒçš„é—®é¢˜ï¼Œä½¿å¾—åŠ©æ‰‹ç±»åœ¨å…¨æ ˆå¯ç”¨æ€§å¤§å¹…æå‡ã€‚
  3. é‡æž„äº†å†—ä½™çš„ `decodeDataByABI` æ–¹æ³•ä¸º `decodeInputDataByABI` ç­‰ä¸“ç”¨äºŽè§£æžè¯·æ±‚å’Œè¿”å›žæŠ¥æ–‡çš„å‡½æ•°ã€‚
  4. ä¼˜åŒ–äº† `src/web3/(ethersTxBatchHelper.ts | ethersLogSyncHelper.ts | ethersLogHelper.ts | erc20Helper.ts)` ç³»åˆ—ä»£ç ï¼Œå¯¹é½äº†æž„é€ å‡½æ•°çš„ Provider ç±»åž‹ç­¾åï¼Œä¿®å¤äº†éƒ¨åˆ†ç±»åž‹å¯¼å‡ºé—®é¢˜ä»¥åŠå¤„ç†ç‰¹å®šåœºæ™¯ä¸‹ `undefined` å€¼å¯èƒ½å¯¼è‡´çš„å´©æºƒä¸Žè­¦å‘Šã€‚

## å¯ç”¨çš„å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜Ž |
|------|------|
| `pnpm build` | æž„å»ºé¡¹ç›® |
| `pnpm start` | è¿è¡Œç¼–è¯‘åŽçš„é¡¹ç›® |
| `pnpm dev` | å¼€å‘æ¨¡å¼ï¼ˆä½¿ç”¨ tsx ç›´æŽ¥è¿è¡Œï¼‰ |
| `pnpm dev:build` | å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬å¹¶ç¼–è¯‘ï¼‰ |
| `pnpm test` | è¿è¡Œæµ‹è¯• |
| `pnpm test:watch` | ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯• |
| `pnpm test:coverage` | è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š |
| `pnpm typecheck` | ç±»åž‹æ£€æŸ¥ |

## é¡¹ç›®ç»“æž„

```
.
â”œâ”€â”€ src/              # æºä»£ç ç›®å½•
â”‚   â””â”€â”€ index.ts      # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ tests/            # æµ‹è¯•æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ index.test.ts # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ dist/             # ç¼–è¯‘è¾“å‡ºç›®å½•
â”œâ”€â”€ vitest.config.ts  # Vitest é…ç½®æ–‡ä»¶
â”œâ”€â”€ tsconfig.json     # TypeScript é…ç½®æ–‡ä»¶
â””â”€â”€ package.json      # é¡¹ç›®é…ç½®æ–‡ä»¶
```

## çŽ¯å¢ƒè¦æ±‚

- Node.js >= 20.0.0
- pnpm >= 10.0.0
